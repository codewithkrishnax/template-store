<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CodeSnap</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Highlight.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/tokyo-night-dark.min.css" id="dark-theme">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/stackoverflow-light.min.css" id="light-theme" disabled>

  <!-- Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    .hljs { background: transparent !important; padding: 0 !important; }
    
    /* Hide scrollbar for clean mobile look */
    ::-webkit-scrollbar { width: 0px; }
    
    /* Native app feel */
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior: none; user-select: none; }
    textarea { user-select: text; }
    
    /* Smooth transitions */
    .theme-btn { transition: all 0.2s ease; }
  </style>
</head>

<body class="bg-white text-gray-900 min-h-screen flex flex-col overflow-hidden">

  <!-- App Header -->
  <header class="px-5 py-4 flex items-center justify-between bg-white border-b border-gray-200">
    <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">
      âš¡ CodeSnap
    </h1>

    <div class="flex bg-gray-100 rounded-full p-1 gap-1">
      <button onclick="setTheme('dark')" id="darkBtn" class="theme-btn px-5 py-1.5 text-sm rounded-full font-medium text-gray-600">Dark</button>
      <button onclick="setTheme('light')" id="lightBtn" class="theme-btn px-5 py-1.5 text-sm rounded-full font-medium bg-white shadow-sm text-gray-900">Light</button>
    </div>
  </header>

  <!-- Editor -->
  <main class="flex-1 overflow-auto p-5 space-y-5">
    <textarea
      id="codeInput"
      class="w-full h-[45vh] bg-gray-50 rounded-2xl p-5 text-sm font-mono outline-none border-2 border-gray-200 focus:border-indigo-400 resize-none transition-colors text-gray-800"
      placeholder="Paste your code here..."
    >function hello() {
  return "Hello World ðŸ‘‹";
}

console.log(hello());</textarea>

    <!-- Background Picker -->
    <div>
      <p class="text-xs font-semibold uppercase tracking-wider text-gray-500 mb-3">Export Background</p>

      <div class="grid grid-cols-4 gap-3">
        <!-- Gradients -->
        <button onclick="setBg(this,'linear-gradient(135deg,#667eea,#764ba2)')" class="bg-gradient-to-br from-indigo-400 to-purple-500 h-14 rounded-2xl ring-4 ring-indigo-400 ring-offset-2 transition-all active:scale-95"></button>
        <button onclick="setBg(this,'linear-gradient(135deg,#f093fb,#f5576c)')" class="bg-gradient-to-br from-pink-400 to-red-400 h-14 rounded-2xl transition-all active:scale-95"></button>
        <button onclick="setBg(this,'linear-gradient(135deg,#4facfe,#00f2fe)')" class="bg-gradient-to-br from-sky-400 to-cyan-400 h-14 rounded-2xl transition-all active:scale-95"></button>
        <button onclick="setBg(this,'linear-gradient(135deg,#43e97b,#38f9d7)')" class="bg-gradient-to-br from-green-400 to-teal-400 h-14 rounded-2xl transition-all active:scale-95"></button>

        <!-- Solids -->
        <button onclick="setBg(this,'#0f0e17')" class="bg-[#0f0e17] h-14 rounded-2xl transition-all active:scale-95 border-2 border-gray-200"></button>
        <button onclick="setBg(this,'#1e1e1e')" class="bg-[#1e1e1e] h-14 rounded-2xl transition-all active:scale-95 border-2 border-gray-200"></button>
        <button onclick="setBg(this,'#ffffff')" class="bg-white h-14 rounded-2xl transition-all active:scale-95 border-2 border-gray-300"></button>
        <button onclick="setBg(this,'#f5f5f5')" class="bg-gray-100 h-14 rounded-2xl transition-all active:scale-95 border-2 border-gray-300"></button>
      </div>
    </div>
  </main>

  <!-- Export Button -->
  <footer class="p-5 border-t border-gray-200 bg-white">
    <button
      onclick="exportImage()"
      class="w-full py-4 rounded-2xl font-semibold text-base text-white
             bg-gradient-to-r from-indigo-500 to-purple-600
             active:scale-[0.98] transition-transform shadow-lg shadow-indigo-500/30"
    >
      ðŸ“¸ Export 4K Image
    </button>
  </footer>

<script>
  let currentBg = 'linear-gradient(135deg,#667eea,#764ba2)';
  let theme = 'light';

  function setBg(el, bg) {
    currentBg = bg;
    document.querySelectorAll('main button').forEach(b => {
      b.classList.remove('ring-4', 'ring-indigo-400', 'ring-offset-2');
    });
    el.classList.add('ring-4', 'ring-indigo-400', 'ring-offset-2');
  }

  function setTheme(t) {
    theme = t;
    document.getElementById('dark-theme').disabled = t !== 'dark';
    document.getElementById('light-theme').disabled = t !== 'light';

    const darkBtn = document.getElementById('darkBtn');
    const lightBtn = document.getElementById('lightBtn');
    
    if (t === 'dark') {
      darkBtn.className = 'theme-btn px-5 py-1.5 text-sm rounded-full font-medium bg-white shadow-sm text-gray-900';
      lightBtn.className = 'theme-btn px-5 py-1.5 text-sm rounded-full font-medium text-gray-600';
    } else {
      lightBtn.className = 'theme-btn px-5 py-1.5 text-sm rounded-full font-medium bg-white shadow-sm text-gray-900';
      darkBtn.className = 'theme-btn px-5 py-1.5 text-sm rounded-full font-medium text-gray-600';
    }
  }

  async function exportImage() {
    const code = document.getElementById('codeInput').value.trim();
    if (!code) {
      Swal.fire({
        title: 'No code found',
        text: 'Please paste some code first',
        icon: 'warning',
        confirmButtonColor: '#6366f1'
      });
      return;
    }

    Swal.fire({
      title: 'Generating image...',
      text: 'Please wait',
      allowOutsideClick: false,
      didOpen: () => { Swal.showLoading(); }
    });

    try {
      // Highlight code first
      const result = hljs.highlightAuto(code);
      const highlighted = result.value;
      const codeBg = theme === 'dark' ? '#1e1e1e' : '#fafafa';
      const codeColor = theme === 'dark' ? '#d4d4d4' : '#383a42';
      
      // Create container
      const container = document.createElement('div');
      container.style.cssText = `
        position: absolute;
        left: 0;
        top: 0;
        width: auto;
        height: auto;
        padding: 50px;
        background: ${currentBg};
      `;

      container.innerHTML = `
        <div style="
          width: 100%;
          max-width: auto;
          margin: 0 auto;
          background: white;
          border-radius: 24px;
          overflow: hidden;
          box-shadow: rgba(0, 0, 0, 0.25) 0px 0.0625em 0.0625em, rgba(0, 0, 0, 0.25) 0px 0.125em 0.5em, rgba(255, 255, 255, 0.1) 0px 0px 0px 1px inset;
        ">
          <div style="
            padding: 20px 24px;
            background: linear-gradient(180deg, #f5f5f5 0%, #e5e5e5 100%);
            display: flex;
            gap: 10px;
            align-items: center;
          ">
            <div style="width:14px;height:14px;border-radius:50%;background:#ff5f56;"></div>
            <div style="width:14px;height:14px;border-radius:50%;background:#ffbd2e;"></div>
            <div style="width:14px;height:14px;border-radius:50%;background:#27c93f;"></div>
          </div>
          <div style="
            padding: 48px;
            background: ${codeBg};
            min-height: 400px;
          ">
            <pre style="
              margin: 0;
              font-size: 18px;
              line-height: 1.6;
              font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
              color: ${codeColor};
            "><code class="hljs language-${result.language || 'plaintext'}">${highlighted}</code></pre>
          </div>
        </div>
      `;

      document.body.appendChild(container);

      // Wait for styles to apply
      await new Promise(resolve => setTimeout(resolve, 10));

      // Apply highlighting
      const codeBlock = container.querySelector('code');
      if (codeBlock) {
        hljs.highlightElement(codeBlock);
      }

      // Wait again for highlight
      await new Promise(resolve => setTimeout(resolve, 10));

      // Export with high quality
      const dataUrl = await htmlToImage.toPng(container, {
        quality: 4,
        pixelRatio: 2,
        width: container.offsetWidth ,
        height: container.offsetHeight ,
        cacheBust: true,
        skipFonts: false
      });

      // Clean up
      document.body.removeChild(container);

      // Download
      const link = document.createElement('a');
      link.download = `codesnap-${Date.now()}.png`;
      link.href = dataUrl;
      link.click();

      Swal.fire({
        title: 'Success!',
        text: 'Image downloaded successfully',
        icon: 'success',
        confirmButtonColor: '#6366f1',
        timer: 2000
      });

    } catch (error) {
      console.error('Export error:', error);
      
      Swal.fire({
        title: 'Export failed',
        text: 'Please try again',
        icon: 'error',
        confirmButtonColor: '#6366f1'
      });
    }
  }
</script>

</body>
</html>